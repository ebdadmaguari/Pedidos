<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Área Administrativa - Pedidos de Revistas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        .actions {
            display: flex;
            gap: 5px;
        }
        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
        }
        .btn-view {
            background-color: #4CAF50;
        }
        .btn-delete {
            background-color: #f44336;
        }
        .btn-print {
            background-color: #2196F3;
        }
        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        input[type="text"], select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .logout-btn {
            float: right;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Sair
        </button>
        <h1>Área Administrativa - Pedidos de Revistas</h1>
        
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Buscar por congregação..." onkeyup="filterOrders()">
            <select id="filterStatus" onchange="filterOrders()">
                <option value="">Todos os status</option>
                <option value="pendente">Pendente</option>
                <option value="processando">Processando</option>
                <option value="concluido">Concluído</option>
            </select>
            <button onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Exportar</button>
        </div>
        
        <div style="overflow-x:auto;">
            <table id="ordersTable">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Grupo</th>
                        <th>Congregação</th>
                        <th>Coordenador</th>
                        <th>Telefone</th>
                        <th>Trimestre</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="ordersBody">
                    <!-- Os pedidos serão inseridos aqui via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Função para carregar os pedidos
        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('pedidosRevistas')) || [];
            const tbody = document.getElementById('ordersBody');
            tbody.innerHTML = '';
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;">Nenhum pedido encontrado</td></tr>';
                return;
            }
            
            orders.forEach(order => {
                const tr = document.createElement('tr');
                const date = new Date(order.timestamp);
                const formattedDate = date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR');
                
                tr.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${order.group || 'Não informado'}</td>
                    <td>${order.congregation || 'Não informado'}</td>
                    <td>${order.coordinator || 'Não informado'}</td>
                    <td>${order.phone || 'Não informado'}</td>
                    <td>${order.trimester || 'Não informado'}</td>
                    <td>${order.total || 'R$ 0,00'}</td>
                    <td>
                        <select onchange="updateStatus('${order.id}', this.value)" style="padding: 5px;">
                            <option value="pendente" ${order.status === 'pendente' ? 'selected' : ''}>Pendente</option>
                            <option value="processando" ${order.status === 'processando' ? 'selected' : ''}>Processando</option>
                            <option value="concluido" ${order.status === 'concluido' ? 'selected' : ''}>Concluído</option>
                        </select>
                    </td>
                    <td class="actions">
                        <button class="btn btn-view" onclick="viewOrder('${order.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-print" onclick="printOrder('${order.id}')">
                            <i class="fas fa-print"></i>
                        </button>
                        <button class="btn btn-delete" onclick="deleteOrder('${order.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Função para filtrar os pedidos
        function filterOrders() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const rows = document.querySelectorAll('#ordersBody tr');
            
            rows.forEach(row => {
                const congregation = row.cells[2].textContent.toLowerCase();
                const status = row.cells[7].querySelector('select').value;
                
                const matchesSearch = congregation.includes(searchText);
                const matchesStatus = !statusFilter || status === statusFilter;
                
                row.style.display = (matchesSearch && matchesStatus) ? '' : 'none';
            });
        }
        
        // Função para visualizar um pedido
        function viewOrder(orderId) {
            const orders = JSON.parse(localStorage.getItem('pedidosRevistas')) || [];
            const order = orders.find(o => o.id === orderId);
            
            if (order) {
                let itemsHtml = '<table border="1" style="width:100%; border-collapse:collapse; margin-top:10px;">';
                itemsHtml += `
                    <tr>
                        <th>Material</th>
                        <th>Alunos</th>
                        <th>Professores</th>
                        <th>Kits</th>
                        <th>Subtotal</th>
                    </tr>
                `;
                
                order.items.forEach(item => {
                    itemsHtml += `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.quantities.aluno || '0'}</td>
                            <td>${item.quantities.professor || '0'}</td>
                            <td>${item.quantities.kit || '0'}</td>
                            <td>${item.subtotal}</td>
                        </tr>
                    `;
                });
                
                itemsHtml += '</table>';
                
                alert(`
                    Detalhes do Pedido:
                    Congregação: ${order.congregation}
                    Coordenador: ${order.coordinator}
                    Telefone: ${order.phone}
                    Trimestre: ${order.trimester}
                    Total: ${order.total}
                    
                    ${itemsHtml}
                `);
            }
        }
        
        // Função para atualizar o status
        function updateStatus(orderId, newStatus) {
            const orders = JSON.parse(localStorage.getItem('pedidosRevistas')) || [];
            const orderIndex = orders.findIndex(o => o.id === orderId);
            
            if (orderIndex !== -1) {
                orders[orderIndex].status = newStatus;
                localStorage.setItem('pedidosRevistas', JSON.stringify(orders));
                showAlert('Status atualizado com sucesso!');
            }
        }
        
        // Função para excluir um pedido
        function deleteOrder(orderId) {
            if (confirm('Tem certeza que deseja excluir este pedido?')) {
                const orders = JSON.parse(localStorage.getItem('pedidosRevistas')) || [];
                const updatedOrders = orders.filter(o => o.id !== orderId);
                localStorage.setItem('pedidosRevistas', JSON.stringify(updatedOrders));
                loadOrders();
                showAlert('Pedido excluído com sucesso!');
            }
        }
        
        // Função para exportar para Excel
        function exportToExcel() {
            // Implementação simplificada - em produção use uma biblioteca como SheetJS
            const orders = JSON.parse(localStorage.getItem('pedidosRevistas')) || [];
            let csv = 'Data,Grupo,Congregação,Coordenador,Telefone,Trimestre,Total,Status\n';
            
            orders.forEach(order => {
                const date = new Date(order.timestamp);
                const formattedDate = date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR');
                
                csv += `"${formattedDate}","${order.group || ''}","${order.congregation || ''}",` +
                      `"${order.coordinator || ''}","${order.phone || ''}","${order.trimester || ''}",` +
                      `"${order.total || 'R$ 0,00'}","${order.status || 'pendente'}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pedidos_revistas_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        // Função de logout
        function logout() {
            window.location.href = 'index.html';
        }
        
        // Função auxiliar para mostrar alertas
        function showAlert(message) {
            alert(message);
        }
        
        // Carrega os pedidos quando a página é aberta
        document.addEventListener('DOMContentLoaded', loadOrders);
    </script>
</body>
</html>
